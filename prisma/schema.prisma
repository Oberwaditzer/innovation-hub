// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

generator typegraphql {
  provider = "typegraphql-prisma"
}

model User {
    id              String              @id @default(cuid())
    createdAt       DateTime            @default(now())
    updatedAt       DateTime            @updatedAt
    username        String              @unique
    email           String              @unique
    emailConfirmed  Boolean             @default(false)
    firstName       String
    lastName        String
    teams           UsersOnTeams[]
    workshops       UsersOnWorkshops[]
}

model Team {
    id         String          @id @default(cuid())
    createdAt  DateTime        @default(now())
    updatedAt  DateTime        @updatedAt
    title      String          @unique
    users      UsersOnTeams[]
    workshops  Workshop[]
}

model Workshop {
    id         String              @id @default(cuid())
    createdAt  DateTime            @default(now())
    updatedAt  DateTime            @updatedAt
    type       String
    title      String
    status     WorkshopStatus      @default(CREATED)
    data       Json                @default("{}")
    step       Int                 @default(1)
    teams      Team[]
    users      UsersOnWorkshops[]
}

enum WorkshopStatus {
    CREATED
    STARTED
    STOPPED
    FINISHED
}

model UsersOnTeams {
    user    User     @relation(fields: [userId], references: [id])
    userId  String
    team    Team     @relation(fields: [teamId], references: [id])
    teamId  String
    admin   Boolean

    @@id([userId, teamId])
}

model UsersOnWorkshops {
    user        User      @relation(fields: [userId], references: [id])
    userId      String
    workshop    Workshop  @relation(fields: [workshopId], references: [id])
    workshopId  String
    admin       Boolean

    @@id([userId, workshopId])
}
